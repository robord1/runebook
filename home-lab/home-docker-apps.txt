services:
  jellyfin:
    image: jellyfin/jellyfin:latest
    container_name: jellyfin
    user: "${UID}:${GID}"
    ports:
      - 8096:8096
    volumes:
      - ./config:/config
      - ./cache:/cache
      - /mnt/ord_media/films:/films
      - /mnt/ord_media/shows:/shows
    restart: unless-stopped




    services:
  db:
    image: mariadb:10.6
    container_name: nextcloud_db
    restart: unless-stopped
    command: --transaction-isolation=READ-COMMITTED --binlog-format=ROW
    environment:
      - MYSQL_ROOT_PASSWORD=xxx
      - MYSQL_PASSWORD=xxx
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
    volumes:
      - /mnt/mydocs/mariadb:/var/lib/mysql
    networks:
      - nextcloud_net

  redis:
    image: redis:alpine
    container_name: nextcloud_redis
    restart: unless-stopped
    command: redis-server --requirepass xxx
    volumes:
      - /mnt/mydocs/redis:/data
    networks:
      - nextcloud_net

  nextcloud:
    image: nextcloud:latest
    container_name: nextcloud
    restart: unless-stopped
    depends_on:
      - db
      - redis
    ports:
      - "xxx"
    environment:
      - MYSQL_HOST=db
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
      - MYSQL_PASSWORD=xxx
      - NEXTCLOUD_TRUSTED_DOMAINS=xxx
      - NEXTCLOUD_DATA_DIR=/var/www/html/data
      - REDIS_HOST=redis
      - REDIS_HOST_PASSWORD=xxx
    volumes:
      - /mnt/mydocs/nextcloud:/var/www/html
      - /mnt/mydocs/nextcloud_data:/var/www/html/data
    networks:
      - nextcloud_net

  cron:
    image: nextcloud:latest
    container_name: nextcloud_cron
    restart: unless-stopped
    entrypoint: /cron.sh
    depends_on:
      - nextcloud
    volumes:
      - /mnt/mydocs/nextcloud:/var/www/html
      - /mnt/mydocs/nextcloud_data:/var/www/html/data
    networks:
      - nextcloud_net

networks:
  nextcloud_net:
    name: nextcloud_net